# Development Dockerfile - for local testing with podman
FROM node:24-alpine

# Install pnpm
RUN corepack enable && corepack prepare pnpm@10.15.1 --activate

# Set working directory
WORKDIR /app

# Copy workspace files
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml nx.json tsconfig.base.json ./
COPY apps/services/authorizer-proxy/package.json ./apps/services/authorizer-proxy/

# Install all dependencies
RUN pnpm install --frozen-lockfile

# Copy all source files
COPY . .

# Set environment variables
ENV NODE_ENV=development
ENV PORT=3001
ENV HOST=0.0.0.0

# Expose port
EXPOSE 3001

# Use nx to run in dev mode
CMD ["pnpm", "nx", "serve", "authorizer-proxy"]